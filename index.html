<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Diet Plan">
    <title>Diet Plan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            /* Apple Fitness Palette */
            --bg-color: #000000;
            
            /* Liquid Glass Variables */
            --glass-bg: rgba(30, 30, 32, 0.60);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-highlight: rgba(255, 255, 255, 0.08);
            --glass-blur: 35px;
            
            --text-primary: #ffffff;
            --text-secondary: #98989d;
            --divider: rgba(255, 255, 255, 0.08);
            --nav-bg: rgba(20, 20, 20, 0.75);
            
            /* Neon Accents */
            --fitness-red: #fa114f;
            --fitness-green: #a4ff00;
            --fitness-cyan: #00e0ff;
            --fitness-orange: #ff9500;
            
            --radius-lg: 28px;
            --radius-sm: 14px;
            --bottom-nav-height: 110px; 
        }

        /* GLOBAL RESET */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html { overflow-x: hidden; background-color: var(--bg-color); }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Rounded", "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            overscroll-behavior-y: none;
            overflow-x: hidden;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* 1. DYNAMIC AMBIENT MESH */
        body::before {
            content: '';
            position: fixed;
            top: -50%; left: -50%; width: 200%; height: 200%;
            background: 
                radial-gradient(at 0% 0%, rgba(250, 17, 79, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(164, 255, 0, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(0, 224, 255, 0.15) 0px, transparent 50%),
                radial-gradient(at 0% 100%, rgba(20, 20, 20, 1) 0px, transparent 50%);
            filter: blur(60px);
            z-index: -1;
            pointer-events: none;
            animation: drift 20s ease-in-out infinite alternate;
        }

        @keyframes drift {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(5deg) scale(1.1); }
        }

        ::-webkit-scrollbar { display: none; }

        .app-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            padding-top: max(10px, env(safe-area-inset-top));
            padding-bottom: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom));
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .view-section {
            display: none;
            animation: fadeIn 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .view-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.96); filter: blur(5px); }
            to { opacity: 1; transform: scale(1); filter: blur(0); }
        }

        /* HEADER with SHIMMER EFFECT */
        header { padding: 10px 15px 20px 15px; text-align: left; }
        h1 { 
            margin: 0; font-size: 36px; font-weight: 800; letter-spacing: 0.3px; line-height: 1.1; 
            /* Shimmer Gradient */
            background: linear-gradient(110deg, #fff 30%, rgba(255,255,255,0.5) 45%, #fff 60%);
            background-size: 200% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: textShimmer 5s infinite linear;
        }
        @keyframes textShimmer {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }
        h2 { margin-top: 5px; font-weight: 700; font-size: 13px; color: var(--fitness-red); text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.9; }

        /* ENHANCED GLASS PANEL */
        .glass-panel {
            background: linear-gradient(160deg, rgba(40, 40, 45, 0.6) 0%, rgba(20, 20, 22, 0.5) 100%);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-top: 1px solid rgba(255, 255, 255, 0.15); /* Specular Highlight */
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            transition: transform 0.2s, background-color 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .glass-panel::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 40%;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none;
        }

        /* SUMMARY GRID */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 35px;
            width: 100%;
            padding: 0 5px;
        }

        .stat-card {
            padding: 18px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 100px;
            /* Added position relative for the arrow */
            position: relative;
        }
        
        /* Arrow for Stat Card */
        .stat-card::before {
            content: '‚Ä∫';
            position: absolute;
            top: 15px;
            right: 18px;
            font-size: 1.4rem;
            color: rgba(255, 255, 255, 0.2);
            font-weight: 600;
            line-height: 1;
            pointer-events: none;
        }

        .stat-value { font-size: 1.7rem; font-weight: 700; font-family: "SF Pro Rounded", system-ui, sans-serif; letter-spacing: 0.5px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.3)); }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); font-weight: 600; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

        /* SECTION TITLES */
        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            margin-top: 35px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: space-between; /* Push arrow to right */
            padding-left: 10px;
            padding-right: 15px;
            letter-spacing: 0.3px;
        }
        
        /* Arrow for Section Titles */
        .section-title::after {
            content: '‚Ä∫';
            font-size: 1.4rem;
            color: rgba(255, 255, 255, 0.3);
            font-weight: 600;
            line-height: 1;
        }

        /* INFO CARDS */
        .protocol-grid { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 0 5px; }
        @media (min-width: 600px) { .protocol-grid { grid-template-columns: 1fr 1fr; } }

        .info-card { padding: 24px; }
        .info-card h4 { margin: 0 0 10px 0; color: var(--fitness-cyan); font-size: 1.1rem; }
        .info-card p { font-size: 0.95rem; color: rgba(255,255,255,0.7); margin-bottom: 8px; line-height: 1.5; }
        .info-card strong { color: #fff; font-weight: 600; }

        /* MEAL PLAN */
        .days-container { display: grid; gap: 14px; padding: 0 5px; }
        .day-card { 
            padding: 20px; 
            cursor: pointer; 
            transition: transform 0.15s cubic-bezier(0.25, 0.8, 0.25, 1); 
            /* Added Padding right to prevent text overlap with arrow */
            padding-right: 40px;
        }
        .day-card:active { transform: scale(0.96); background: rgba(50, 50, 55, 0.7); }
        
        .day-card::after {
            content: '‚Ä∫';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.4rem;
            color: rgba(255,255,255,0.3); /* Slightly brighter arrow */
            font-weight: 600;
            line-height: 1;
        }

        .day-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--divider);
            /* Reduced header padding since card has it now */
            padding-right: 0; 
        }
        .day-name { font-size: 1.2rem; font-weight: 700; color: var(--text-primary); }
        
        .day-stats { display: flex; gap: 8px; }
        .stat-badge { font-size: 0.7rem; font-weight: 700; padding: 4px 8px; border-radius: 8px; letter-spacing: 0.3px; backdrop-filter: blur(4px); }
        .stat-cals { color: var(--fitness-red); background: rgba(250, 17, 79, 0.1); border: 1px solid rgba(250, 17, 79, 0.2); }
        .stat-prot { color: var(--fitness-green); background: rgba(164, 255, 0, 0.1); border: 1px solid rgba(164, 255, 0, 0.2); }
        
        .meal-row { margin-bottom: 15px; padding-left: 0; }
        .meal-row:last-child { margin-bottom: 0; }
        .meal-title { font-size: 0.7rem; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 4px; font-weight: 700; letter-spacing: 0.5px; opacity: 0.8; }
        .meal-content { font-size: 1rem; color: rgba(255,255,255,0.9); margin-bottom: 6px; line-height: 1.4; font-weight: 500; }

        /* BADGES */
        .badges-wrapper { display: flex; gap: 6px; flex-wrap: wrap; }
        .badge { font-size: 0.7rem; padding: 4px 10px; border-radius: 8px; font-weight: 700; display: inline-block; backdrop-filter: blur(10px); }
        .badge-protein { color: #000; background: linear-gradient(135deg, #a4ff00, #80cc00); box-shadow: 0 2px 10px rgba(164, 255, 0, 0.2); }
        .badge-millet { color: #000; background: linear-gradient(135deg, #ff9500, #cc7700); }
        .badge-info { color: var(--fitness-cyan); background-color: rgba(0, 224, 255, 0.1); border: 1px solid rgba(0, 224, 255, 0.15); }
        .badge-cal { color: var(--fitness-red); border: 1px solid rgba(250, 17, 79, 0.2); background: rgba(250, 17, 79, 0.05); }

        /* FULL SCREEN MODAL */
        .day-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            height: 100dvh; /* Mobile viewport fix */
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; 
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .day-modal.active { 
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
        }

        .modal-sheet {
            background: rgba(28, 28, 30, 0.85);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            width: 100%;
            height: 92vh;
            height: 92dvh; /* Mobile viewport fix */
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            padding: 0; 
            position: relative;
            box-shadow: 0 -10px 60px rgba(0,0,0,0.6);
            border-top: 1px solid rgba(255,255,255,0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            overscroll-behavior: contain;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .day-modal.active .modal-sheet { transform: translateY(0); }

        .modal-handle-container {
            width: 100%;
            display: flex;
            justify-content: center;
            padding-top: 15px;
            padding-bottom: 15px;
            background: transparent;
            z-index: 20;
            flex-shrink: 0;
            touch-action: none;
        }
        .modal-handle {
            width: 40px;
            height: 5px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .modal-header-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 25px 20px 25px;
            background: transparent;
            border-bottom: 1px solid var(--divider); 
            flex-shrink: 0;
            z-index: 20;
        }
        .modal-day-title { font-size: 2.2rem; font-weight: 800; color: white; letter-spacing: -0.5px; }
        .modal-close-btn {
            background: rgba(255,255,255,0.1); color: #fff; border: none;
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 1rem; cursor: pointer; font-weight: 700;
        }

        .modal-body-content { 
            padding: 25px 25px 120px 25px;
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden; /* Prevent horizontal scroll */
            overscroll-behavior: contain; 
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-meal-row { margin-bottom: 40px; }
        .modal-meal-type { font-size: 0.9rem; color: var(--fitness-orange); text-transform: uppercase; font-weight: 700; margin-bottom: 8px; letter-spacing: 1px; }
        /* Fix for horizontal overflow */
        .modal-meal-desc { 
            font-size: 1.6rem; 
            line-height: 1.3; 
            color: white; 
            margin-bottom: 15px; 
            font-weight: 600; 
            font-family: "SF Pro Rounded"; 
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
            word-wrap: break-word; /* Ensure wrapping */
            hyphens: auto;
        }
        .modal-badges-wrapper { transform: scale(1.1); transform-origin: left; }

        /* WALKING TOOL */
        .walking-tool-card {
            padding: 40px 20px;
            display: flex; flex-direction: column; align-items: center;
            margin-top: 10px;
            margin-left: 5px; margin-right: 5px;
        }

        .ring-container {
            position: relative;
            width: 260px;
            height: 260px;
            margin-bottom: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .progress-ring__circle-bg { stroke: rgba(255,255,255,0.03); }
        .progress-ring__circle {
            stroke: var(--fitness-green);
            stroke-linecap: round;
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            /* Enhanced Neon Glow */
            filter: drop-shadow(0 0 10px rgba(164, 255, 0, 0.6));
        }

        .timer-value-container { position: absolute; text-align: center; }
        .timer-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--text-primary);
            font-variant-numeric: tabular-nums;
            line-height: 1;
            letter-spacing: -2px;
            font-family: "SF Pro Rounded";
            text-shadow: 0 0 30px rgba(164, 255, 0, 0.2);
        }
        .timer-label {
            font-size: 1.1rem;
            color: var(--fitness-green);
            text-transform: uppercase;
            font-weight: 700;
            margin-top: 5px;
            letter-spacing: 2px;
            opacity: 0.9;
        }

        /* 3. TACTILE GEL BUTTONS */
        .controls { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            margin-bottom: 20px; 
            z-index: 10; 
        }
        
        .btn-round {
            width: 70px; height: 70px;
            border-radius: 50%; border: none;
            font-size: 1.8rem; display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        .btn-round:active { transform: scale(0.9); }
        
        /* Glossy overlay for buttons */
        .btn-round::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 100%);
            border-radius: 50%;
            pointer-events: none;
        }

        .start-btn { 
            width: 80px; height: 80px; /* Main button stays big */
            background: linear-gradient(145deg, #a4ff00, #7abb00); 
            color: #000; 
            box-shadow: 
                0 10px 25px rgba(164, 255, 0, 0.4),
                inset 0 2px 5px rgba(255,255,255,0.5);
        }
        
        .stop-btn { 
            width: 80px; height: 80px;
            background: linear-gradient(145deg, #fa114f, #d00033); 
            color: #fff; 
            box-shadow: 
                0 10px 25px rgba(250, 17, 79, 0.4),
                inset 0 2px 5px rgba(255,255,255,0.4);
        }
        
        .reset-btn { 
            background: rgba(255,255,255,0.1); 
            color: var(--text-primary); 
            width: 50px; height: 50px; font-size: 1.2rem; 
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .edit-btn {
            background: rgba(255,255,255,0.1); 
            color: var(--fitness-cyan); 
            width: 50px; height: 50px; font-size: 1.2rem; 
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .notify-btn {
            background: rgba(255,255,255,0.1); 
            color: var(--fitness-orange); 
            width: 50px; height: 50px; font-size: 1.2rem; 
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .session-stats {
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding-top: 10px;
        }
        .s-stat { text-align: center; }
        .s-val { font-size: 1.5rem; font-weight: 700; color: var(--text-primary); font-family: "SF Pro Rounded", sans-serif; }
        .s-lbl { font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }

        /* CALENDAR ACTIVITY GRID */
        .calendar-card {
            padding: 24px;
            margin-top: 15px;
            margin-left: 5px; margin-right: 5px;
        }
        .calendar-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; color: var(--text-primary); font-weight: 700; font-size: 1.2rem;
        }
        .cal-nav-btn {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); color: var(--fitness-green);
            width: 34px; height: 34px; border-radius: 50%;
            font-size: 1.2rem; cursor: pointer; display: flex; justify-content: center; align-items: center; padding-bottom: 3px;
            transition: background 0.2s;
        }
        .cal-nav-btn:active { background: rgba(255,255,255,0.2); }
        .calendar-days-header {
            display: grid; grid-template-columns: repeat(7, 1fr); margin-bottom: 12px; text-align: center;
        }
        .calendar-days-header span { font-size: 0.75rem; color: var(--text-secondary); font-weight: 700; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .cal-day-cell { display: flex; justify-content: center; align-items: center; }
        .cal-ring-container {
            width: 100%; aspect-ratio: 1; position: relative;
            display: flex; justify-content: center; align-items: center;
        }
        .cal-day-num { position: absolute; font-size: 0.75rem; color: rgba(255,255,255,0.7); font-weight: 600; }

        .technique-list li {
            margin-bottom: 12px; padding-left: 20px; position: relative;
            color: rgba(255,255,255,0.8); font-size: 1rem;
        }
        .technique-list li::before { content: '‚úì'; color: var(--fitness-green); position: absolute; left: 0; font-weight: 800; }

        /* TRACKER & DATE RANGE */
        .date-range-container {
            display: flex; gap: 15px; margin-bottom: 20px;
            padding: 18px 24px;
            justify-content: space-between;
            align-items: center;
            margin-left: 5px; margin-right: 5px;
        }
        .date-input-group { display: flex; flex-direction: column; flex: 1; }
        .date-input-group label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; }
        
        .date-input {
            background: rgba(0, 0, 0, 0.2); /* Darker inlay */
            border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 10px;
            color: var(--fitness-green);
            padding: 10px 12px; 
            font-family: inherit; font-size: 1rem; font-weight: 600;
            width: 100%; -webkit-appearance: none;
            transition: all 0.2s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        .date-input:focus {
            background: rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
            outline: none;
        }
        .date-input::-webkit-calendar-picker-indicator {
            filter: invert(1); opacity: 0.6;
        }
        
        .reset-date-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: var(--text-secondary);
            border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: opacity 0.2s;
        }
        .reset-date-btn:active { background: rgba(255,255,255,0.15); }

        /* CHART CONTAINER */
        .chart-wrapper {
            padding: 15px;
            margin-bottom: 20px;
            height: 250px;
            position: relative;
            margin-left: 5px; margin-right: 5px;
        }

        /* UPDATED TRACKER LIST (iOS Style) */
        .tracker-grid {
            display: flex;
            flex-direction: column;
            padding: 0; 
            overflow: hidden; 
            gap: 0; 
            margin-left: 5px; margin-right: 5px;
        }
        
        .tracker-cell {
            background-color: transparent; 
            padding: 18px 24px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--divider);
            position: relative;
        }
        .tracker-cell:last-child {
            border-bottom: none;
        }
        .tracker-cell:active {
            background-color: rgba(255,255,255,0.05); 
        }

        .tracker-date {
            font-size: 1.05rem;
            color: var(--text-primary);
            font-weight: 500;
            margin: 0;
            flex: 1; 
            text-align: left;
        }

        .tracker-input-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tracker-input {
            width: 85px;
            background: rgba(0, 0, 0, 0.2); /* Darker inlay for better contrast */
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            color: white; 
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            margin: 0;
            padding: 8px;
            font-family: "SF Pro Rounded";
            transition: all 0.2s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .tracker-input::-webkit-outer-spin-button,
        .tracker-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .tracker-input:focus {
            background: rgba(164, 255, 0, 0.15); /* Slight green tint on focus */
            border-color: var(--fitness-green);
            outline: none;
            color: #fff;
            box-shadow: 0 0 15px rgba(164, 255, 0, 0.2);
        }
        .tracker-input::placeholder {
            color: rgba(255, 255, 255, 0.2);
        }

        .diff-badge {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
            min-width: 55px;
            text-align: center;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        .diff-loss { color: #000; background: linear-gradient(135deg, #a4ff00, #80cc00); }
        .diff-gain { color: #fff; background: linear-gradient(135deg, #fa114f, #d00033); }
        .diff-neutral { color: var(--text-secondary); background: rgba(255,255,255,0.1); }


        /* BOTTOM NAVIGATION (Floating Glass Pill) */
        .bottom-nav {
            position: fixed;
            bottom: max(20px, env(safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            max-width: 360px;
            background: rgba(45, 45, 50, 0.65); /* Lighter, milkier glass */
            backdrop-filter: blur(40px) saturate(180%);
            -webkit-backdrop-filter: blur(40px) saturate(180%);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border-radius: 40px; /* Pill Shape */
            display: flex; justify-content: space-evenly;
            align-items: center;
            padding: 14px 20px;
            z-index: 1000;
        }

        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; 
            color: rgba(255, 255, 255, 0.5); /* Dim inactive state */
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer; 
            -webkit-tap-highlight-color: transparent;
            width: 60px;
            position: relative;
        }
        
        .nav-item.active { 
            color: #ffffff; 
            /* Spotlight Effect */
            background: radial-gradient(circle at center, rgba(164, 255, 0, 0.15) 0%, transparent 70%);
            border-radius: 20px;
        }
        
        .nav-icon {
            width: 28px; height: 28px; 
            margin-bottom: 4px; 
            fill: currentColor;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .nav-item.active .nav-icon { 
            transform: translateY(-4px) scale(1.1); 
            fill: var(--fitness-green); 
            filter: drop-shadow(0 0 15px rgba(164, 255, 0, 0.6)); /* Stronger Neon Glow */
        } 

        .nav-label { 
            font-size: 10px; 
            font-weight: 600; 
            letter-spacing: 0.3px; 
            opacity: 0.7;
        }
        .nav-item.active .nav-label {
            opacity: 1;
            font-weight: 700;
        }

        /* CELEBRATION MODAL */
        .award-modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(20px);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        .award-modal.active { display: flex; }
        .award-content {
            background: rgba(30, 30, 35, 0.8);
            backdrop-filter: blur(40px);
            padding: 40px 30px;
            border-radius: 40px;
            text-align: center;
            border: 1px solid rgba(164, 255, 0, 0.3);
            box-shadow: 0 0 60px rgba(164, 255, 0, 0.2);
            transform: scale(0.9);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            max-width: 90%;
        }
        @keyframes popIn { to { transform: scale(1); } }
        
        .award-icon { font-size: 80px; margin-bottom: 10px; display: block; animation: bounce 1.5s infinite; filter: drop-shadow(0 0 20px rgba(164,255,0,0.5)); }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .award-content h2 { color: #a4ff00; font-size: 2.2rem; margin: 0 0 10px 0; font-weight: 800; letter-spacing: -1px; text-shadow: 0 0 20px rgba(164,255,0,0.4); }
        .award-content p { color: #fff; margin-bottom: 30px; font-size: 1.1rem; opacity: 0.9; }
        .award-close-btn {
            background: linear-gradient(135deg, #a4ff00, #80cc00); color: #000; border: none;
            padding: 16px 45px; border-radius: 30px; font-weight: 700;
            font-size: 1.1rem; cursor: pointer; transition: transform 0.1s;
            box-shadow: 0 5px 20px rgba(164, 255, 0, 0.3);
        }
        .award-close-btn:active { transform: scale(0.95); }

        /* iOS INSTALL PROMPT */
        .ios-prompt {
            display: none; position: fixed; bottom: 100px; left: 20px; right: 20px;
            background: rgba(30, 30, 35, 0.9); backdrop-filter: blur(30px);
            padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.15);
            z-index: 2000; animation: slideUp 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .save-status {
            position: fixed; top: 20px; right: 20px;
            background: rgba(46, 125, 50, 0.8); backdrop-filter: blur(20px); color: white;
            padding: 8px 16px; border-radius: 20px; font-size: 0.8rem;
            font-weight: bold; opacity: 0; transition: opacity 0.5s; pointer-events: none; z-index: 2000;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .save-status.visible { opacity: 1; }

    </style>
</head>
<body>

<div class="app-content">

    <div id="view-diet" class="view-section active">
        <header>
            <h1>Diet Plan</h1>
            <h2>30-Day Aggressive Cut</h2>
        </header>

        <div class="summary-grid">
            <div class="stat-card glass-panel">
                <span class="stat-value" style="color: var(--fitness-cyan)">16:8</span>
                <span class="stat-label">Fasting</span>
            </div>
            <div class="stat-card glass-panel">
                <span class="stat-value" style="color: var(--fitness-red)">1200</span>
                <span class="stat-label">Calories</span>
            </div>
            <div class="stat-card glass-panel">
                <span class="stat-value" style="color: var(--fitness-green)">Millets</span>
                <span class="stat-label">Carbs</span>
            </div>
            <div class="stat-card glass-panel">
                <span class="stat-value" style="color: var(--fitness-orange)">Whole</span>
                <span class="stat-label">Food Only</span>
            </div>
        </div>

        <h3 class="section-title">Nutrition Insights</h3>
        <div class="protocol-grid">
            <div class="info-card glass-panel">
                <h4>üåæ Why Millets?</h4>
                <p><strong>Low GI:</strong> Prevents insulin spikes, forcing fat burn.</p>
                <p><strong>Satiety:</strong> Keeps you full for 4-5 hours.</p>
            </div>
            <div class="info-card glass-panel">
                <h4>üìä Nutrient Density</h4>
                <p><strong>Ragi:</strong> Calcium.</p>
                <p><strong>Bajra:</strong> Iron.</p>
                <p><strong>Jowar:</strong> Gut health.</p>
            </div>
        </div>

        <h3 class="section-title">Weekly Schedule</h3>
        <div class="days-container">
            <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Sunday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1200 kcal</span>
                        <span class="stat-badge stat-prot">65g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content"><strong>2 Small Ragi Rotis</strong> + 120g Paneer Bhurji + 100g Cucumber.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~480 kcal</span><span class="badge badge-millet">Calcium</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content"><strong>Spiced Soya Chunks</strong> (40g dry wt, boiled & saut√©ed).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~180 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content"><strong>Grilled Tofu Salad</strong> (150g Tofu + 50g Veggies).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~320 kcal</span></div>
                </div>
            </div>

            <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Monday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1180 kcal</span>
                        <span class="stat-badge stat-prot">50g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content"><strong>Foxtail Millet</strong> (100g Cooked) + 200g Rajma Masala + 100g Green Salad.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~400 kcal</span><span class="badge badge-millet">Low GI</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content">150g Greek Yogurt + 10g Chia Seeds.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~140 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content">300ml Spinach Soup + <strong>120g Saut√©ed Paneer</strong>.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~370 kcal</span></div>
                </div>
            </div>

             <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Tuesday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1200 kcal</span>
                        <span class="stat-badge stat-prot">70g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content"><strong>2 Jowar Rotis</strong> + Soya Chunk Curry (50g dry wt).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~400 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content"><strong>Grilled Tofu Cubes</strong> (100g) with Lemon.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~140 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content"><strong>Warm Soya Salad</strong> (50g dry wt Soya + 100g Veggies).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~250 kcal</span></div>
                </div>
            </div>

            <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Wednesday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1220 kcal</span>
                        <span class="stat-badge stat-prot">55g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content">2 Besan Chillas + <strong>80g Paneer Stuffing</strong>.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~440 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content">100g Sprouted Moong Salad.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~120 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content">150g Stir-fry Veggies + <strong>150g Grilled Tofu</strong>.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~320 kcal</span></div>
                </div>
            </div>

            <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Thursday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1200 kcal</span>
                        <span class="stat-badge stat-prot">45g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content"><strong>Barnyard Millet Khichdi</strong> (200g) + 100g Saut√©ed Spinach.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~350 kcal</span><span class="badge badge-millet">Fiber Rich</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content"><strong>50g Roasted Black Chana</strong>.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~180 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content"><strong>Papaya (100g) & Cucumber (100g) Salad</strong> + 100g Paneer.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~320 kcal</span></div>
                </div>
            </div>

            <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Friday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1250 kcal</span>
                        <span class="stat-badge stat-prot">45g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content"><strong>2 Bajra Rotis</strong> + Palak Paneer (120g Paneer).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~550 kcal</span><span class="badge badge-protein">Protein Rich</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content">30g Roasted Makhana.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~100 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content"><strong>High Protein Chana Salad</strong> (100g Boiled Chana + 100g Veggies + 100g Curd).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~250 kcal</span></div>
                </div>
            </div>

            <div class="day-card glass-panel" onclick="openDayModal(this)">
                <div class="day-header">
                    <span class="day-name">Saturday</span>
                    <div class="day-stats">
                        <span class="stat-badge stat-cals">1250 kcal</span>
                        <span class="stat-badge stat-prot">55g Prot</span>
                    </div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">12:00 PM - Break Fast</div>
                    <div class="meal-content"><strong>Little Millet</strong> (100g Cooked) + 200g Chole Curry.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~350 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">4:00 PM - Snack</div>
                    <div class="meal-content"><strong>Saut√©ed Tofu</strong> (100g) with Garlic & Herbs.</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~140 kcal</span></div>
                </div>
                <div class="meal-row">
                    <div class="meal-title">7:30 PM - Dinner</div>
                    <div class="meal-content"><strong>Paneer Tikka</strong> (120g Paneer + 50g Veggies).</div>
                    <div class="badges-wrapper"><span class="badge badge-cal">~350 kcal</span><span class="badge badge-protein">Cheat Meal Feel</span></div>
                </div>
            </div>
        </div>

        <h3 class="section-title">Guidelines</h3>
        <div class="info-card glass-panel" style="border: 1px solid rgba(250, 17, 79, 0.3); background: rgba(250, 17, 79, 0.1);">
            <strong>‚ö†Ô∏è 1200 kcal Warning</strong>
            <p>This is a low-calorie intake. If dizzy, add a fruit. Eat unlimited cucumbers.</p>
        </div>
    </div>

    <div id="view-workout" class="view-section">
        <header>
            <h1>Workout</h1>
            <h2>Brisk Walking</h2>
        </header>

        <div class="walking-tool-card glass-panel">
            <div class="ring-container">
                <svg class="progress-ring" width="260" height="260">
                    <circle class="progress-ring__circle-bg" stroke="#1c1c1e" stroke-width="18" fill="transparent" r="110" cx="130" cy="130"/>
                    <circle class="progress-ring__circle" id="timer-ring" stroke-dasharray="691 691" stroke-dashoffset="0" stroke-width="18" fill="transparent" r="110" cx="130" cy="130"/>
                </svg>
                <div class="timer-value-container">
                    <div class="timer-display" id="walk-timer">45:00</div>
                    <div class="timer-label">Remaining</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-round reset-btn" onclick="resetWalk()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                </button>
                
                <button class="btn-round notify-btn" onclick="requestNotification()" title="Allow Notifications">
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                </button>

                <button class="btn-round edit-btn" onclick="manualSetTimer()">
                    <svg viewBox="0 0 24 24" width="22" height="22" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                </button>

                <button class="btn-round start-btn" id="toggle-btn" onclick="toggleTimer()">
                    <svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                </button>
            </div>

            <div class="session-stats">
                <div class="s-stat">
                    <span class="s-val" id="est-cals" style="color: var(--fitness-red);">0</span>
                    <span class="s-lbl">KCAL</span>
                </div>
                <div class="s-stat">
                    <span class="s-val" style="color: var(--fitness-green);">45</span>
                    <span class="s-lbl">GOAL</span>
                </div>
            </div>
        </div>

        <h3 class="section-title">Technique</h3>
        <div class="info-card glass-panel">
            <ul class="technique-list">
                <li><strong>Posture:</strong> Tall spine, eyes forward.</li>
                <li><strong>Arms:</strong> Bent 90¬∞, swing from shoulders.</li>
                <li><strong>Strike:</strong> Heel to toe roll.</li>
                <li><strong>Target:</strong> 45 Mins Daily (Morning).</li>
            </ul>
        </div>

        <h3 class="section-title">Activity Calendar</h3>
        <div class="calendar-card glass-panel">
            <div class="calendar-header">
                <button class="cal-nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
                <span id="cal-month-year"></span>
                <button class="cal-nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
            </div>
            <div class="calendar-days-header">
                <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
            </div>
            <div class="calendar-grid" id="activity-grid">
                </div>
        </div>
    </div>

    <div id="view-tracker" class="view-section">
        <header>
            <h1>Progress</h1>
            <h2>Weight Log</h2>
        </header>

        <div class="date-range-container glass-panel">
            <div class="date-input-group">
                <label>Start Date</label>
                <input type="date" id="tracker-start" class="date-input">
            </div>
            <div class="date-input-group">
                <label>End Date</label>
                <input type="date" id="tracker-end" class="date-input">
            </div>
            <button class="reset-date-btn" onclick="resetDates()" title="Reset Range">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
            </button>
        </div>

        <div class="chart-wrapper glass-panel">
            <canvas id="weightChart"></canvas>
        </div>

        <div id="tracker-container" class="tracker-grid glass-panel">
            </div>
    </div>

</div>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('diet', this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 3h-1V1h-2v2H8V1H6v2H8V1H6v2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
        </svg>
        <span class="nav-label">Plan</span>
    </div>
    <div class="nav-item" onclick="switchTab('workout', this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM9.8 8.9L7 23h2.1l1.8-8 2.1 2v6h2v-7.5l-2.1-2 .6-3C14.8 12 16.8 13 19 13v-2c-1.9 0-3.5-1-4.3-2.4l-1-1.6c-.4-.6-1-1-1.7-1-.3 0-.5.1-.8.1L6 8.3V13h2V9.6l1.8-.7z"/>
        </svg>
        <span class="nav-label">Workout</span>
    </div>
    <div class="nav-item" onclick="switchTab('tracker', this)">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
        </svg>
        <span class="nav-label">Progress</span>
    </div>
</nav>

<div id="award-modal" class="award-modal">
    <div class="award-content">
        <div class="award-icon">üèÜ</div>
        <h2>Goal Crushed!</h2>
        <p>You completed 45 minutes of brisk walking.</p>
        <button class="award-close-btn" onclick="closeAward()">Awesome!</button>
    </div>
</div>

<div id="day-modal" class="day-modal">
    <div class="modal-sheet">
        <div class="modal-handle-container">
            <div class="modal-handle"></div>
        </div>
        <div class="modal-header-bar">
            <div id="modal-day-title" class="modal-day-title">Monday</div>
            <button class="modal-close-btn" onclick="closeDayModal()">‚úï</button>
        </div>
        <div id="modal-body-content" class="modal-body-content">
            </div>
    </div>
</div>

<div id="ios-install-prompt" class="ios-prompt">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <strong>Install App</strong>
        <span onclick="document.getElementById('ios-install-prompt').style.display='none'">‚úï</span>
    </div>
    <p>1. Tap <strong>Share</strong> button <br> 2. Tap <strong>Add to Home Screen</strong></p>
</div>

<div id="save-status" class="save-status">‚úì Saved</div>

<script>
    // --- TAB NAVIGATION ---
    function switchTab(tabId, element) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + tabId).classList.add('active');
        element.classList.add('active');
        document.querySelector('.app-content').scrollTop = 0;
    }

    // --- DAY MODAL LOGIC (New) ---
    function openDayModal(card) {
        const modal = document.getElementById('day-modal');
        const dayName = card.querySelector('.day-name').innerText;
        const mealRows = card.querySelectorAll('.meal-row');
        
        document.getElementById('modal-day-title').innerText = dayName;
        
        let contentHtml = '';
        
        mealRows.forEach(row => {
            const title = row.querySelector('.meal-title').innerText;
            const content = row.querySelector('.meal-content').innerHTML;
            const badges = row.querySelector('.badges-wrapper') ? row.querySelector('.badges-wrapper').outerHTML : '';
            
            contentHtml += `
                <div class="modal-meal-row">
                    <div class="modal-meal-type">${title}</div>
                    <div class="modal-meal-desc">${content}</div>
                    <div class="modal-badges-wrapper">${badges}</div>
                </div>
            `;
        });
        
        document.getElementById('modal-body-content').innerHTML = contentHtml;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Lock scroll
    }

    function closeDayModal() {
        document.getElementById('day-modal').classList.remove('active');
        document.body.style.overflow = ''; // Unlock scroll
    }

    // --- SWIPE TO CLOSE LOGIC (NEW) ---
    const modalSheet = document.querySelector('.modal-sheet');
    const modalBody = document.getElementById('modal-body-content');
    
    let startY = 0;
    let currentTranslateY = 0;
    let isDragging = false;

    // Handle touch start
    modalSheet.addEventListener('touchstart', (e) => {
        // Only drag if the body is scrolled to the top OR we are touching the header/handle
        const isHeader = e.target.closest('.modal-handle-container') || e.target.closest('.modal-header-bar');
        const isBodyAtTop = modalBody.scrollTop <= 0;

        if (isHeader || isBodyAtTop) {
            isDragging = true;
            startY = e.touches[0].clientY;
            modalSheet.style.transition = 'none'; // Disable transition for direct 1:1 movement
        } else {
            isDragging = false;
        }
    }, { passive: true });

    // Handle touch move
    modalSheet.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        
        const currentY = e.touches[0].clientY;
        const diff = currentY - startY;

        // Only move if dragging down
        if (diff > 0) {
            // Prevent scroll chaining if we are dragging the sheet
            if(e.cancelable) e.preventDefault(); 
            
            currentTranslateY = diff;
            modalSheet.style.transform = `translateY(${diff}px)`;
        }
    }, { passive: false });

    // Handle touch end
    modalSheet.addEventListener('touchend', (e) => {
        if (!isDragging) return;
        isDragging = false;
        
        // Restore transition for smooth snap/close
        modalSheet.style.transition = 'transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)';

        if (currentTranslateY > 150) {
            // Dragged far enough: Close
            modalSheet.style.transform = 'translateY(100%)';
            setTimeout(() => {
                closeDayModal();
                modalSheet.style.transform = ''; // Reset for next open
            }, 300);
        } else {
            // Snap back
            modalSheet.style.transform = '';
        }
        currentTranslateY = 0;
    });

    // --- TIMER LOGIC (COUNTDOWN + NO AUDIO) ---
    const GOAL_MINUTES = 45;
    const GOAL_MS = GOAL_MINUTES * 60 * 1000;
    
    // Keys
    const KEY_TARGET_END = 'walkTargetEnd';     // When the timer is scheduled to finish (timestamp)
    const KEY_REMAINING = 'walkRemaining';      // Saved remaining ms when paused
    const KEY_IS_RUNNING = 'walkIsRunning';
    const KEY_ACTIVITY_LOG = 'walkActivityLog'; // { "YYYY-MM-DD": minutes }
    const KEY_LAST_NOTIFIED = 'walkLastNotified'; // Track last notification minute

    // Init Calendar View Date (Must be defined before usage)
    let calendarViewDate = new Date();

    const timerDisplay = document.getElementById('walk-timer');
    const toggleBtn = document.getElementById('toggle-btn');
    const calsDisplay = document.getElementById('est-cals');
    const ringCircle = document.getElementById('timer-ring');
    
    // SVG Config
    const radius = ringCircle.r.baseVal.value;
    const circumference = radius * 2 * Math.PI;
    ringCircle.style.strokeDasharray = `${circumference} ${circumference}`;
    ringCircle.style.strokeDashoffset = circumference; 

    // --- NOTIFICATION API ---
    function requestNotification() {
        if (!("Notification" in window)) {
            alert("This browser does not support desktop notification");
        } else if (Notification.permission === "granted") {
            alert("Notifications already enabled!");
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(function (permission) {
                if (permission === "granted") {
                    alert("Notifications enabled!");
                }
            });
        }
    }

    function triggerNotification(msg, body) {
        if (Notification.permission === "granted") {
            try {
                // For Mobile Safari, this works best if app is installed to Home Screen
                new Notification(msg, {
                    body: body,
                    icon: "https://cdn-icons-png.flaticon.com/512/2583/2583290.png" 
                });
                
                // Fallback Vibration
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
            } catch(e) {
                console.log("Notification failed", e);
            }
        }
    }

    // --- WEB WORKER FOR BACKGROUND TIMING ---
    // We use a Blob to create a worker inline without a separate file
    const workerBlob = new Blob([`
        let timerInterval;
        self.onmessage = function(e) {
            if (e.data === 'start') {
                timerInterval = setInterval(() => {
                    self.postMessage('tick');
                }, 1000);
            } else if (e.data === 'stop') {
                clearInterval(timerInterval);
            }
        };
    `], { type: 'application/javascript' });
    
    const timerWorker = new Worker(URL.createObjectURL(workerBlob));
    
    timerWorker.onmessage = function(e) {
        if (e.data === 'tick') {
            updateTimerLoop();
        }
    };

    function setProgress(percent) {
        const offset = circumference - (percent / 100) * circumference;
        ringCircle.style.strokeDashoffset = offset;
    }

    // CELEBRATION LOGIC
    function showAward() {
        // Launch Confetti
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#a4ff00', '#ffffff'] // Neon green & white
        });

        // Show Modal
        document.getElementById('award-modal').classList.add('active');
    }

    function closeAward() {
        document.getElementById('award-modal').classList.remove('active');
    }

    function toggleTimer() {
        const isRunning = localStorage.getItem(KEY_IS_RUNNING) === 'true';
        
        if (isRunning) {
            // PAUSE
            timerWorker.postMessage('stop');
            
            const targetEnd = parseInt(localStorage.getItem(KEY_TARGET_END) || 0);
            const remaining = Math.max(0, targetEnd - Date.now());
            
            localStorage.setItem(KEY_REMAINING, remaining);
            localStorage.setItem(KEY_IS_RUNNING, 'false');
            localStorage.removeItem(KEY_TARGET_END);
            
            logDailyActivity(remaining); 
            setBtnStart();
            updateTimerVisuals();
        } else {
            // START
            // Start Worker
            timerWorker.postMessage('start');

            const currentRemaining = parseInt(localStorage.getItem(KEY_REMAINING));
            const duration = (!isNaN(currentRemaining) && currentRemaining > 0) ? currentRemaining : GOAL_MS;
            
            localStorage.setItem(KEY_TARGET_END, Date.now() + duration);
            localStorage.setItem(KEY_IS_RUNNING, 'true');
            
            setBtnStop();
        }
    }

    function updateTimerLoop() {
        const targetEnd = parseInt(localStorage.getItem(KEY_TARGET_END) || 0);
        const remaining = targetEnd - Date.now();

        // 1. FINISHED (45 mins or less)
        if (remaining <= 0) {
            timerWorker.postMessage('stop');
            triggerNotification("Session Complete!", "Slow down and cool off"); 
            
            localStorage.setItem(KEY_IS_RUNNING, 'false');
            localStorage.setItem(KEY_REMAINING, 0);
            localStorage.removeItem(KEY_TARGET_END);
            
            logDailyActivity(0); 
            showAward(); 
            
            setBtnStart();
            updateTimerVisuals();
            return;
        }

        // 2. INTERMEDIATE NOTIFICATIONS (5-40 mins)
        const completedMs = GOAL_MS - remaining;
        const completedMinutes = Math.floor(completedMs / 60000);
        const lastNotified = parseInt(localStorage.getItem(KEY_LAST_NOTIFIED) || 0);

        if (completedMinutes > 0 && completedMinutes % 5 === 0 && completedMinutes > lastNotified) {
             let msg = "";
             switch(completedMinutes) {
                 case 5: msg = "Walk slow ‚Äì easy pace, relax your body"; break;
                 case 10: msg = "Walk fast ‚Äì pick up the pace, stay strong"; break;
                 case 15: msg = "Walk slow ‚Äì recover, breathe steady"; break;
                 case 20: msg = "Walk fast ‚Äì brisk steps, swing your arms"; break;
                 case 25: msg = "Walk slow ‚Äì ease back, keep moving"; break;
                 case 30: msg = "Walk fast ‚Äì strong pace, you‚Äôre doing great"; break;
                 case 35: msg = "Walk slow ‚Äì controlled and relaxed"; break;
                 case 40: msg = "Walk fast ‚Äì final push, stay focused"; break;
             }

             if(msg) {
                 triggerNotification(`${completedMinutes} Mins Done`, msg);
                 localStorage.setItem(KEY_LAST_NOTIFIED, completedMinutes);
             }
        }

        updateTimerVisuals(remaining);
        
        if (Math.floor(Date.now() / 1000) % 60 === 0) {
             logDailyActivity(remaining);
        }
    }

    function updateTimerVisuals(forceRemaining) {
        let remaining;
        
        if (forceRemaining !== undefined) {
            remaining = forceRemaining;
        } else if (localStorage.getItem(KEY_IS_RUNNING) === 'true') {
            const targetEnd = parseInt(localStorage.getItem(KEY_TARGET_END) || 0);
            remaining = Math.max(0, targetEnd - Date.now());
        } else {
            const saved = parseInt(localStorage.getItem(KEY_REMAINING));
            remaining = !isNaN(saved) ? saved : GOAL_MS;
        }

        // Format Time
        const totalSec = Math.ceil(remaining / 1000);
        const mins = Math.floor(totalSec / 60);
        const secs = totalSec % 60;
        timerDisplay.textContent = `${pad(mins)}:${pad(secs)}`;

        // Calories (Estimate based on completed time)
        const completedMinutes = (GOAL_MS - remaining) / 1000 / 60;
        calsDisplay.textContent = Math.floor(completedMinutes * 8.5);

        // Ring Progress
        // 45:00 remaining = 0% progress. 00:00 remaining = 100% progress.
        const percent = ((GOAL_MS - remaining) / GOAL_MS) * 100;
        setProgress(percent);
    }

    function logDailyActivity(remainingMs) {
        const completedMs = GOAL_MS - remainingMs;
        const mins = completedMs / 1000 / 60;
        
        // Use YYYY-MM-DD as key
        const todayKey = new Date().toISOString().split('T')[0];
        
        let log = JSON.parse(localStorage.getItem(KEY_ACTIVITY_LOG) || '{}');
        log[todayKey] = Math.max(log[todayKey] || 0, mins); 
        
        localStorage.setItem(KEY_ACTIVITY_LOG, JSON.stringify(log));
        renderCalendar();
    }

    function resetWalk() {
        timerWorker.postMessage('stop');
        
        localStorage.removeItem(KEY_TARGET_END);
        localStorage.removeItem(KEY_IS_RUNNING);
        localStorage.removeItem(KEY_LAST_NOTIFIED); // Reset notification tracker
        localStorage.setItem(KEY_REMAINING, GOAL_MS); 
        
        setBtnStart();
        updateTimerVisuals();
        setProgress(0);
    }

    // --- MANUAL TIMER SET ---
    function manualSetTimer() {
        // 1. Pause if running
        if (localStorage.getItem(KEY_IS_RUNNING) === 'true') {
            toggleTimer(); 
        }

        // 2. Prompt user
        const input = prompt("Set Timer (Minutes)\nEnter 0.1 for quick test (6 seconds):", "45");
        
        if (input !== null && input !== "") {
            const mins = parseFloat(input);
            if (!isNaN(mins) && mins > 0) {
                // 3. Convert to MS and Save
                const newMs = Math.floor(mins * 60 * 1000);
                localStorage.setItem(KEY_REMAINING, newMs);
                
                // 4. Update Visuals
                updateTimerVisuals(newMs);
                
                // 5. Update Ring Progress
                const percent = ((GOAL_MS - newMs) / GOAL_MS) * 100;
                setProgress(percent);
            }
        }
    }

    // --- ACTIVITY CALENDAR RENDERER ---
    function changeMonth(offset) {
        calendarViewDate.setMonth(calendarViewDate.getMonth() + offset);
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('activity-grid');
        const monthLabel = document.getElementById('cal-month-year');
        if(!grid) return;

        grid.innerHTML = '';
        const year = calendarViewDate.getFullYear();
        const month = calendarViewDate.getMonth();
        
        monthLabel.textContent = calendarViewDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

        const firstDayIndex = new Date(year, month, 1).getDay(); // 0 = Sunday
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        const activityLog = JSON.parse(localStorage.getItem(KEY_ACTIVITY_LOG) || '{}');

        // Empty cells for days before the 1st
        for (let i = 0; i < firstDayIndex; i++) {
            const cell = document.createElement('div');
            cell.className = 'cal-day-cell empty';
            grid.appendChild(cell);
        }

        // Days
        for (let i = 1; i <= daysInMonth; i++) {
            // Construct YYYY-MM-DD key manually to avoid timezone issues
            const m = String(month + 1).padStart(2, '0');
            const d = String(i).padStart(2, '0');
            const safeKey = `${year}-${m}-${d}`;

            const minsDone = activityLog[safeKey] || 0;
            const percent = Math.min(100, (minsDone / 45) * 100); // 45 is goal

            const cell = document.createElement('div');
            cell.className = 'cal-day-cell';
            
            // SVG Circle for Ring
            // If < 100% show faint or red? If done show green.
            // Let's do: Green if any progress, just partial ring.
            const ringColor = '#a4ff00';
            
            // Mini Ring SVG
            const svgHtml = `
                <div class="cal-ring-container">
                    <svg width="36" height="36" viewBox="0 0 36 36">
                        <path
                            d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#2c2c2e"
                            stroke-width="3"
                        />
                        <path
                            d="M18 2.0845
                                a 15.9155 15.9155 0 0 1 0 31.831
                                a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="${percent > 0 ? ringColor : 'none'}"
                            stroke-width="3"
                            stroke-dasharray="${percent}, 100"
                            stroke-linecap="round"
                            style="filter: drop-shadow(0 0 2px ${percent > 0 ? ringColor : 'transparent'})"
                        />
                    </svg>
                    <span class="cal-day-num">${i}</span>
                </div>
            `;
            
            cell.innerHTML = svgHtml;
            grid.appendChild(cell);
        }
    }

    function setBtnStart() { 
        toggleBtn.innerHTML = '<svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>'; 
        toggleBtn.classList.remove('stop-btn'); toggleBtn.classList.add('start-btn'); 
    }
    function setBtnStop() { 
        toggleBtn.innerHTML = '<svg viewBox="0 0 24 24" width="32" height="32" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'; 
        toggleBtn.classList.remove('start-btn'); toggleBtn.classList.add('stop-btn'); 
    }
    function pad(val) { return val < 10 ? '0' + val : val; }


    // --- WEIGHT TRACKER LOGIC ---
    const container = document.getElementById('tracker-container');
    const storageKey = 'fatLossWeightTracker';
    const saveStatus = document.getElementById('save-status');
    const startInput = document.getElementById('tracker-start');
    const endInput = document.getElementById('tracker-end');

    // Default or stored range
    const today = new Date();
    const future = new Date();
    future.setDate(today.getDate() + 30);

    const storedStart = localStorage.getItem('trackerStartDate');
    const storedEnd = localStorage.getItem('trackerEndDate');

    startInput.value = storedStart || today.toISOString().split('T')[0];
    endInput.value = storedEnd || future.toISOString().split('T')[0];

    // Load data
    let savedData = JSON.parse(localStorage.getItem(storageKey)) || {};
    let inputs = [];
    let weightChart;

    // Initialize Chart
    function initChart() {
        const ctx = document.getElementById('weightChart').getContext('2d');
        
        // Create Apple Fitness style gradient
        const gradient = ctx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(164, 255, 0, 0.4)'); // Top: Semi-transparent Neon Green
        gradient.addColorStop(1, 'rgba(164, 255, 0, 0.0)'); // Bottom: Transparent

        Chart.defaults.color = '#8e8e93';
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "SF Pro Rounded", "Segoe UI", Roboto, sans-serif';
        
        weightChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Weight',
                    data: [],
                    borderColor: '#a4ff00', // --fitness-green
                    borderWidth: 4,
                    
                    /* NEON GLOW EFFECT */
                    shadowColor: 'rgba(164, 255, 0, 0.6)',
                    shadowBlur: 15,
                    shadowOffsetX: 0,
                    shadowOffsetY: 0,
                    
                    backgroundColor: gradient,
                    pointBackgroundColor: '#000',
                    pointBorderColor: '#a4ff00',
                    pointBorderWidth: 2,
                    pointRadius: 0, 
                    pointHoverRadius: 6, 
                    pointHoverBackgroundColor: '#000',
                    pointHoverBorderColor: '#a4ff00',
                    pointHoverBorderWidth: 3,
                    fill: true,
                    tension: 0.4, // Smooth curve
                    borderCapStyle: 'round',
                    borderJoinStyle: 'round'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(30, 30, 35, 0.9)',
                        titleColor: '#fff',
                        titleFont: { size: 12, weight: '600' },
                        bodyColor: '#a4ff00',
                        bodyFont: { size: 14, weight: '700', family: 'SF Pro Rounded' },
                        padding: 12,
                        cornerRadius: 12,
                        borderColor: 'rgba(255,255,255,0.1)',
                        borderWidth: 1,
                        displayColors: false,
                        callbacks: {
                            label: (ctx) => `${ctx.parsed.y} kg`
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false, drawBorder: false },
                        ticks: { 
                            color: '#8e8e93',
                            font: { size: 10 },
                            maxTicksLimit: 6, 
                            maxRotation: 0 
                        },
                        border: { display: false }
                    },
                    y: {
                        grid: { 
                            color: 'rgba(255,255,255,0.05)',
                            borderDash: [5, 5],
                            drawBorder: false
                        },
                        border: { display: false },
                        ticks: {
                            color: '#8e8e93',
                            font: { size: 10 },
                            padding: 10
                        }
                    }
                }
            }
        });
    }

    function updateChart() {
        // Visualize ALL data, ignoring the start/end input range filters
        const dataPoints = [];
        const labels = [];

        // Sort keys to ensure chronological order
        const sortedKeys = Object.keys(savedData).sort();

        sortedKeys.forEach(dateStr => {
            const d = new Date(dateStr);
            const val = parseFloat(savedData[dateStr]);
            
            // Only add valid numbers
            if (!isNaN(val)) {
                // Format Label
                const label = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                labels.push(label);
                dataPoints.push(val);
            }
        });

        weightChart.data.labels = labels;
        weightChart.data.datasets[0].data = dataPoints;
        weightChart.update();
    }

    function renderTracker() {
        // Clear existing
        container.innerHTML = '';
        inputs = [];

        const start = new Date(startInput.value);
        const end = new Date(endInput.value);
        let current = new Date(start);

        // Sanity check
        if(isNaN(start.getTime()) || isNaN(end.getTime()) || start > end) return;

        while (current <= end) {
            const dateKey = current.toISOString().split('T')[0];
            
            const cell = document.createElement('div');
            cell.className = 'tracker-cell';

            // Left: Date
            const label = document.createElement('span');
            label.className = 'tracker-date';
            // Show "Weekday, Month Day"
            label.textContent = current.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });

            // Right: Wrapper for Input + Badge
            const rightWrapper = document.createElement('div');
            rightWrapper.className = 'tracker-input-wrapper';

            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'tracker-input';
            input.placeholder = '0.0'; 
            input.step = '0.1';
            input.dataset.key = dateKey;
            
            if (savedData[dateKey]) input.value = savedData[dateKey];

            const badge = document.createElement('span');
            badge.className = 'diff-badge';

            // Events
            input.addEventListener('input', (e) => {
                savedData[dateKey] = e.target.value;
                localStorage.setItem(storageKey, JSON.stringify(savedData));
                calculateDiffs();
                updateChart();
                showSave();
            });

            rightWrapper.appendChild(input);
            rightWrapper.appendChild(badge);
            
            cell.appendChild(label); 
            cell.appendChild(rightWrapper);
            
            container.appendChild(cell);
            inputs.push({ input, badge });
            
            current.setDate(current.getDate() + 1);
        }
        calculateDiffs();
        updateChart();
    }

    // Listen for date changes
    startInput.addEventListener('change', () => {
        localStorage.setItem('trackerStartDate', startInput.value);
        renderTracker();
    });
    endInput.addEventListener('change', () => {
        localStorage.setItem('trackerEndDate', endInput.value);
        renderTracker();
    });

    function resetDates() {
        // Dynamic dates for current context
        const now = new Date();
        const futureDate = new Date();
        futureDate.setDate(now.getDate() + 30);
        
        const defaultStart = now.toISOString().split('T')[0];
        const defaultEnd = futureDate.toISOString().split('T')[0];
        
        startInput.value = defaultStart;
        endInput.value = defaultEnd;
        
        // Save preferences but DO NOT clear fatLossWeightTracker data
        localStorage.setItem('trackerStartDate', defaultStart);
        localStorage.setItem('trackerEndDate', defaultEnd);
        renderTracker(); // This will re-render grid/chart with existing data for the new range
    }

    function calculateDiffs() {
        let lastVal = null;
        inputs.forEach(({ input, badge }) => {
            const val = parseFloat(input.value);
            badge.className = 'diff-badge';
            badge.textContent = '';
            
            if (!isNaN(val)) {
                if (lastVal !== null) {
                    const diff = val - lastVal;
                    badge.textContent = diff > 0 ? `+${diff.toFixed(1)}` : diff.toFixed(1);
                    badge.classList.add(diff > 0 ? 'diff-gain' : (diff < 0 ? 'diff-loss' : 'diff-neutral'));
                } else {
                    badge.textContent = 'Start';
                }
                lastVal = val;
            }
        });
    }

    function showSave() {
        saveStatus.classList.add('visible');
        setTimeout(() => saveStatus.classList.remove('visible'), 2000);
    }

    // Initial Timer Setup
    function initTimer() {
        const isRunning = localStorage.getItem(KEY_IS_RUNNING) === 'true';
        if (isRunning) {
            setBtnStop();
            // Resume worker worker on reload
            timerWorker.postMessage('start');
        } else {
            setBtnStart();
        }
        updateTimerVisuals(); // Immediate render
        renderCalendar(); // New Calendar Function
    }

    // --- APPLICATION START ---
    document.addEventListener('DOMContentLoaded', () => {
        initTimer();
        initChart();
        renderTracker();

        // iOS check
        if (/iPhone|iPad/.test(navigator.userAgent) && !window.navigator.standalone) {
            setTimeout(() => document.getElementById('ios-install-prompt').style.display = 'block', 2000);
        }
    });

</script>

</body>
</html>
